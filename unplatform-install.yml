---
# Install and manage unplatform build as local user
- hosts: local
  connection: local
  tasks:
    - name: Install Unplatform requirements
      pip:
        requirements: /var/www/webapps/unplatform/requirements.txt
        virtualenv: /usr/local/.virtualenvs/unplatform
        virtualenv_python: python2.7
        state: forcereinstall
    - name: Provision Unplatform Node.js
      command: /usr/local/.virtualenvs/unplatform/bin/nodeenv -p
    - name: Create the compile command from template
      template:
        src: unplatform_compile.j2
        dest: /usr/local/.virtualenvs/unplatform/compile
        mode: u+x
    - name: Compile Unplatform
      command: /usr/local/.virtualenvs/unplatform/compile
